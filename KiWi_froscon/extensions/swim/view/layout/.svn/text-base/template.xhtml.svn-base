<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                             "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:s="http://jboss.com/products/seam/taglib"
         xmlns:rich="http://richfaces.org/rich"
       xmlns:a4j="http://richfaces.org/a4j"
       xmlns:c="http://java.sun.com/jstl/core"
       xmlns:kiwi="http://www.kiwi-project.eu/jsf"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
       template="/layout/template-2col.xhtml"
      >

    <ui:define name="header">
       <a4j:loadScript src="resource://jquery.js"/>

       <style type="text/css">
           #formWikiEdit\:contentTextArea {
               width: 98%;
           }

           #formWikiEdit\:content {
               width: 100%;
               height: 100%;
           }
       </style>

        <!-- kiwilink panel -->
        <!-- TODO: only show in editor
        <ui:include src="../dialogs/kiwilink.xhtml">
            <ui:param name="projectName" value="KiWi"/>
        </ui:include>
        -->

        <!-- bookmark panel -->
        <!-- TODO: only show in editor
        <ui:include src="../dialogs/bookmark.xhtml">
            <ui:param name="projectName" value="KiWi"/>
        </ui:include>

        <ui:include src="../dialogs/addtype.xhtml"/>

        <ui:include src="../dialogs/addlinkproperty.xhtml"/>
        <ui:include src="../dialogs/removelinkproperty.xhtml"/>
        -->


        <!-- knowledgespace panel -->
        <ui:include src="../dialogs/knowledgespaces.xhtml"/>


        <!-- tagging panel -->
        <ui:include src="../dialogs/edittags.xhtml"/>
        <ui:include src="../dialogs/mediaupload.xhtml" />
    </ui:define>

    <ui:define name="navigation">
        <ui:include src="navigation.xhtml" />
    </ui:define>

    <ui:define name="body">
	<f:view contentType="application/xhtml+xml"/>

        <div id="article">
            <div class="actionmenu" >
                <div class="actionmenu-label">
                    <h:outputText value="#{messages['wiki.menu.actions']}"/>
                </div>
                <div class="actionmenu-items" style="display: none;">
                    <h:form id="formWikiMenu">
                       <hr/>
                          <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.view']}" action="/swim/home.xhtml"/>
                       <hr/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_content']}" action="/swim/edit.xhtml"/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_media']}" action="/swim/media.xhtml"/>
                       <hr/>
                       <a href="#" class="actionmenu-item" onclick="#{rich:component('taggingPanel')}.show();">#{messages['wiki.menu.edit_tags']}</a>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_annotations']}" action="/swim/annotate.xhtml"/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_metadata']}" action="/swim/metadata.xhtml"/>
                       <hr/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.history']}" action="/swim/history.xhtml"/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.barcodeexport']}" action="/swim/barcodeexport.xhtml"/>
                    </h:form>
                </div>
                <script type="text/javascript">
                jQuery(".actionmenu").click(function() {
                    jQuery(".actionmenu-items").slideToggle("fast");
                });
                </script>
            </div>

            <ui:insert name="content" />
        </div>

        <s:div id="articlemeta">
            <h2>References</h2>
            <div>
               <b>Incoming</b>
                <rich:tree style="width:150px" switchType="client">
                    <rich:recursiveTreeNodesAdaptor
                          roots="#{referencesWidget.incoming}"
                          var="item"
                          nodes="#{item.children}">
                        <rich:treeNode>
                            <s:link view="/home.xhtml" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                        </rich:treeNode>
                    </rich:recursiveTreeNodesAdaptor>
                </rich:tree>
                <s:span style="color:red; text-align: center;" rendered="#{referencesWidget.incomingCount==referencesWidget.limit}"><center>more than <h:outputText value="#{referencesWidget.limit}" /> links</center></s:span>
            </div>

            <div style="margin-top: 1em;">
               <b>Outgoing</b>
                <rich:tree style="width:150px" switchType="client">
                    <rich:recursiveTreeNodesAdaptor
                          roots="#{referencesWidget.outgoing}"
                          var="item"
                          nodes="#{item.children}">
                        <rich:treeNode>
                            <s:link view="/home.xhtml" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                        </rich:treeNode>
                    </rich:recursiveTreeNodesAdaptor>
                </rich:tree>
                <s:span style="color:red;" rendered="#{referencesWidget.outgoingCount==referencesWidget.limit}"><center>more than <h:outputText value="#{referencesWidget.limit}" /> links</center></s:span>

            </div>

            <h2>Activities</h2>

            <ul>
                <ui:repeat value="#{activityWidget.activities}" var="activity">
                    <li>
                        <h:outputText value="#{activity.created}" ><s:convertDateTime dateStyle="short"/></h:outputText>
                        <h:outputText value=": " />
                        <h:outputText escape="false" value="#{messages.get(fn:join('widget.',activity.getMessageIdentifier()))}"/>
                    </li>
                </ui:repeat>
            </ul>

            <h2>Related Recommendations</h2>
            <s:span id="recomlist" rendered="#{recommendationActionScope.recommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendation" value="#{recommendationActionScope.recommendations}" >
                        <li>
                        <s:link view="/home.xhtml" value="#{recommendation.title}" propagation="none">
                            <f:param name="title" value="#{recommendation.title}"/>
                            <f:param name="uri"/>
                            <f:param name="id" />
                            <f:param name="kiwiid" value="#{recommendation.resource.kiwiIdentifier}"/>
                        </s:link><br/>
                        <h:outputText value="by "/>
                        <h:outputText value="#{recommendation.author.firstName} "/>
                        <h:outputText value="#{recommendation.author.lastName}"/>
                        </li>
                    </ui:repeat>
                    </ul>
                </div>
            </s:span>
            <s:span id="norecomlist" rendered="#{recommendationActionScope.recommendations.size() &lt;= 0}">
                        <h:outputText value="No recommendations so far."/>
            </s:span>

            <!--

            <h2>Multifactor Recommendation</h2>

            <s:span id="recomMultiFactorList" rendered="#{recommendationActionScope.multiFactorRecommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendation" value="#{recommendationActionScope.multiFactorRecommendations}" >
                        <li>
                        <s:link view="/home.xhtml" value="#{recommendation.title}" propagation="none">
                            <f:param name="title" value="#{recommendation.title}"/>
                            <f:param name="uri"/>
                            <f:param name="id" />
                        </s:link><br/>
                        <h:outputText value="by "/>
                        <h:outputText value="#{recommendation.author.firstName} "/>
                        <h:outputText value="#{recommendation.author.lastName}"/>
                        <br/>
                        <h:outputText value="score: "/>
                        <h:outputText value="#{recommendation.contentItemScore} "/>
                        </li>
                    </ui:repeat>
                    </ul>
                </div>
            </s:span>
            <s:span id="norecomMultiFactorList" rendered="#{recommendationActionScope.multiFactorRecommendations.size() &lt;= 0}">
                        <h:outputText value="No Multifactor Recommendations"/>
            </s:span>


            <h2>Grouped Recommendation</h2>

            <s:span id="recomlistbytags" rendered="#{recommendationActionScope.groupedRecommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendationbytags" value="#{recommendationActionScope.groupedRecommendations}" >
                    <li><h:outputText value="#{recommendationbytags.getKey().title}"/>
                        <ul>
                        <ui:repeat var="contentitems" value="#{recommendationbytags.getValue()}">
                            <li>
                            <kiwi:link contentItem="#{contentitems}"/>
                            <br/>
                            <h:outputText value="by "/>
                            <h:outputText value="#{contentitems.author.firstName} "/>
                            <h:outputText value="#{contentitems.author.lastName}"/>
                            </li>
                        </ui:repeat>
                        </ul>
                    </li>
                    </ui:repeat>
                      </ul>
                </div>
            </s:span>
            <s:span id="norecomlistbytags" rendered="#{recommendationActionScope.groupedRecommendations.size() &lt;= 0}">
                        <h:outputText value="No Grouped Recommendations"/>
            </s:span>

        -->

        </s:div>
    </ui:define>
</ui:composition>
