<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                             "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:s="http://jboss.com/products/seam/taglib"
         xmlns:rich="http://richfaces.org/rich"
       xmlns:a4j="http://richfaces.org/a4j"
       xmlns:c="http://java.sun.com/jstl/core"
       xmlns:kiwi="http://www.kiwi-project.eu/jsf"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
       template="template-2col.xhtml"
      >

    <ui:define name="header">
       <a4j:loadScript src="resource://jquery.js"/>
        <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jquery-ui-1.7.2.min.js"></script>

        <!--  load JQuery Lightbox for slideshows -->
        <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/jqueryplugins/jquery-lightbox-0.5/js/jquery.lightbox-0.5.pack.js"></script>
        <link rel="stylesheet" type="text/css" href="#{facesContext.externalContext.requestContextPath}/js/jqueryplugins/jquery-lightbox-0.5/css/jquery.lightbox-0.5.css" media="screen" />

        <!-- load KiWi widgets -->
        <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/widgets/activity/widget.activity.js"></script>
        <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/widgets/recommendations/widget.recommendations.js"></script>
        <script src="#{facesContext.externalContext.requestContextPath}/js/jqueryplugins/jquery.ui.stars-2.1/ui.stars.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="#{facesContext.externalContext.requestContextPath}/js/jqueryplugins/jquery.ui.stars-2.1/ui.stars.css"/>
        <script src="#{facesContext.externalContext.requestContextPath}/widgets/rating/widget.rating.js" type="text/javascript"></script>

       <style type="text/css">
           #formWikiEdit\:contentTextArea {
               width: 98%;
           }

           #formWikiEdit\:content {
               width: 100%;
               height: 100%;
           }
       </style>


        <!-- generic dialog panel -->
        <ui:include src="/dialog.xhtml" />


        <!-- knowledgespace panel -->
        <ui:include src="/dialogs/knowledgespaces.xhtml"/>

        <!-- tagging panel -->
        <ui:include src="/dialogs/edittags.xhtml"/>
        <ui:include src="/dialogs/mediaupload.xhtml" />
    </ui:define>

    <ui:define name="navigation">
        <ui:include src="navigation.xhtml" />
    </ui:define>

    <ui:define name="body">


        <div id="article">
            <div class="actionmenu" >
                <div class="actionmenu-label">
                    <h:outputText value="#{messages['wiki.menu.actions']}"/>
                </div>
                <div class="actionmenu-items" style="display: none;">
                    <h:form id="formWikiMenu">
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.view']}" action="/wiki/home.xhtml"/>
                       <hr/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_content']}" action="/wiki/edit.xhtml"/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_media']}" action="/wiki/media.xhtml"/>
                       <hr/>
                       <a4j:commandLink reRender="taggingPanel" styleClass="actionmenu-item" oncomplete="#{rich:component('taggingPanel')}.show();">#{messages['wiki.menu.edit_tags']}</a4j:commandLink>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_annotations']}" action="/wiki/annotate.xhtml"/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.edit_metadata']}" action="/wiki/metadata.xhtml"/>
                       <hr/>
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.history']}" action="/wiki/history.xhtml"/>
                       <!--
                       <s:link styleClass="actionmenu-item" value="#{messages['wiki.menu.barcodeexport']}" action="/wiki/barcodeexport.xhtml"/>
                       -->
                    </h:form>
                </div>
                <script type="text/javascript">
                jQuery(".actionmenu").click(function() {
                    jQuery(".actionmenu-items").slideToggle("fast");
                });
                </script>
            </div>

            <ui:insert name="content" />
        </div>


        <s:div id="articlemeta">

            <h2>References</h2>
            <div>
               <b>Incoming</b>
                <rich:tree style="width:150px" switchType="client">
                    <rich:recursiveTreeNodesAdaptor
                          roots="#{referencesWidget.incoming}"
                          var="item"
                          nodes="#{item.children}">
                        <rich:treeNode>
                            <s:link view="/home.xhtml" style="font-weight: bold;" rendered="#{not item.inferred}" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                            <s:link style="font-style: italic;" rendered="#{item.inferred}" view="/home.xhtml" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                        </rich:treeNode>
                    </rich:recursiveTreeNodesAdaptor>
                </rich:tree>
                <s:span style="color:red; text-align: center;" rendered="#{referencesWidget.incomingCount==referencesWidget.limit}"><center>more than <h:outputText value="#{referencesWidget.limit}" /> links</center></s:span>
            </div>

            <div style="margin-top: 1em;">
               <b>Outgoing</b>
                <rich:tree style="width:150px" switchType="client">
                    <rich:recursiveTreeNodesAdaptor
                          roots="#{referencesWidget.outgoing}"
                          var="item"
                          nodes="#{item.children}">
                        <rich:treeNode>
                            <s:link view="/home.xhtml" style="font-weight: bold;" rendered="#{not item.inferred}" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                            <s:link view="/home.xhtml" style="font-style: italic;" rendered="#{item.inferred}" value="#{item.data.label} (#{item.data.namespacePrefix})"  propagation="none">
                                <f:param name="title"/>
                                <f:param name="uri"/>
                                <f:param name="id" />
                                <f:param name="kiwiid" value="#{item.data.kiwiIdentifier}"/>
                            </s:link>
                        </rich:treeNode>
                    </rich:recursiveTreeNodesAdaptor>
                </rich:tree>
                <s:span style="color:red;" rendered="#{referencesWidget.outgoingCount==referencesWidget.limit}"><center>more than <h:outputText value="#{referencesWidget.limit}" /> links</center></s:span>

            </div>

            <h2>Activities</h2>

            <div id="activities"></div>

            <script>
                jQuery(document).ready(function(){
                    jQuery('#activities').activity(
                       { uri:           '#{currentContentItem.resource.uri}',
                         webServiceUrl: '#{facesContext.externalContext.requestContextPath}/seam/resource/services/widgets/activity/list'});
                });
            </script>

            <!--
            <ul>
                <ui:repeat value="#{activityWidget.activities}" var="activity">
                    <li>
                        <h:outputText value="#{activity.created}" ><s:convertDateTime dateStyle="short"/></h:outputText>
                        <h:outputText value=": " />
                        <h:outputText escape="false" value="#{messages.get(fn:join('widget.',activity.getMessageIdentifier()))}"/>
                    </li>
                </ui:repeat>
            </ul>
            -->
           

            <h2>Related Recommendations</h2>
			
			<div id="recommendations"></div>
            <script>
                jQuery(document).ready(function(){
                    jQuery('#recommendations').recommendations(
                       { uri:           '#{currentContentItem.resource.uri}',
                         user:          '#{currentUser.login}',
                         mode:          'vectors',
                         webServiceUrl: '#{facesContext.externalContext.requestContextPath}/seam/resource/services/widgets/recommendations'});
                });  
            </script>
			
			<!--
            <s:span id="recomlist" rendered="#{recommendationActionScope.recommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendation" value="#{recommendationActionScope.recommendations}" >
                        <li>
                        <s:link view="/home.xhtml" value="#{recommendation.title}" propagation="none">
                            <f:param name="title" value="#{recommendation.title}"/>
                            <f:param name="uri"/>
                            <f:param name="id" />
                            <f:param name="kiwiid" value="#{recommendation.resource.kiwiIdentifier}"/>
                        </s:link><br/>
                        <h:outputText value="by "/>
                        <h:outputText value="#{recommendation.author.firstName} "/>
                        <h:outputText value="#{recommendation.author.lastName}"/>
                        </li>
                    </ui:repeat>
                    </ul>
                </div>
            </s:span>
            <s:span id="norecomlist" rendered="#{recommendationActionScope.recommendations.size() &lt;= 0}">
                        <h:outputText value="No recommendations so far."/>
            </s:span>
            -->
			
            <!--
           <h2>Multifactor Recommendation</h2>

            <s:span id="recomMultiFactorList" rendered="#{recommendationActionScope.multiFactorRecommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendation" value="#{recommendationActionScope.multiFactorRecommendations}" >
                        <li>
                        <s:link view="/home.xhtml" value="#{recommendation.title}" propagation="none">
                            <f:param name="title" value="#{recommendation.title}"/>
                            <f:param name="uri"/>
                            <f:param name="id" />
							<f:param name="kiwiid" value="#{recommendation.resource.kiwiIdentifier}"/>                            
                        </s:link><br/>
                        <h:outputText value="by "/>
                        <h:outputText value="#{recommendation.author.firstName} "/>
                        <h:outputText value="#{recommendation.author.lastName}"/>
                        <br/>
                        <h:outputText value="score: "/>
                        <h:outputText value="#{recommendation.contentItemScore} "/><h:outputText value="%"/>
                        </li>
                    </ui:repeat>
                    </ul>
                </div>
            </s:span>
            <s:span id="norecomMultiFactorList" rendered="#{recommendationActionScope.multiFactorRecommendations.size() &lt;= 0}">
                        <h:outputText value="No Multifactor Recommendations"/>
            </s:span>


            <h2>Grouped Recommendation</h2>

            <s:span id="recomlistbytags" rendered="#{recommendationActionScope.groupedRecommendations.size() &gt; 0}">
                <div><ul>
                    <ui:repeat var="recommendationbytags" value="#{recommendationActionScope.groupedRecommendations}" >
                    <li><b><h:outputText value="Tag:"/><h:outputText value="#{recommendationbytags.getKey().title}"/></b>
                        <ul>
                        <ui:repeat var="contentitems" value="#{recommendationbytags.getValue()}">
                            <li>
                            <kiwi:link contentItem="#{contentitems}"/>
                            <br/>
                            <h:outputText value="by "/>
                            <h:outputText value="#{contentitems.author.firstName} "/>
                            <h:outputText value="#{contentitems.author.lastName}"/>
                            </li>
                        </ui:repeat>
                        </ul>
                    </li>
                    </ui:repeat>
                      </ul>
                </div>
            </s:span>
            <s:span id="norecomlistbytags" rendered="#{recommendationActionScope.groupedRecommendations.size() &lt;= 0}">
                        <h:outputText value="No Grouped Recommendations"/>
            </s:span>

        -->

        </s:div>
    </ui:define>
</ui:composition>