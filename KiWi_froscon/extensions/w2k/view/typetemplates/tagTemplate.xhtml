<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
    xmlns:kiwi="http://www.kiwi-project.eu/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
	xmlns:a="http://richfaces.org/a4j">
	    <h1>
	    	#{contentItem.title}
	    	<h:outputText value=" " />
	    	<s:span style="font-size:65%;">(<kiwi:watcher contentItem="#{contentItem}" />)</s:span>
	    </h1>
        <span>
            <h:outputText value="#{messages['wiki.createdon']} "/><h:outputText value="#{contentItem.created}"><s:convertDateTime pattern="dd/MM/yyyy"/></h:outputText><h:outputText value=" - "/> 
            <h:outputText value="#{messages['wiki.updateon']} "/><h:outputText value="#{contentItem.modified}"><s:convertDateTime pattern="dd/MM/yyyy"/></h:outputText><h:outputText value=" "/> 
            <h:outputText value="#{messages['wiki.by']} "/><kiwi:link resource="#{contentItem.author.resource}" value=" #{contentItem.author.firstName} #{contentItem.author.lastName}"/>
        </span>
       	<br/>
       	<!--  I have arbitrarily removed features from a tag template, so I can 
       	recognize it... whoever thinks recommending/rating/tagging tags is a good idea
       	should feel free to uncomment the relevant parts...
			 -->
			 
			 <!-- 
			 <span>
 		<h:outputText value="Recommend it !"/>
 		<rich:inplaceSelect value="#{recommendationAction.userLogin}" defaultLabel="  Choose a friend"
 		showControls="true" controlsHorizontalPosition="left" controlClass="rich-inplace-select-control" reRender="inplaceSelect"  controlsVerticalPosition="bottom" id="inplaceSelect">
                <f:facet name="controls">
                    <button onmousedown="#{rich:component('inplaceSelect')}.save();"
                         type="button">Recommend</button>
                    <button onmousedown="#{rich:component('inplaceSelect')}.cancel();"
                        type="button">Cancel</button> 
                </f:facet>    
                        
				<s:selectItems value="#{kiwi.dashboard.contactsAction.allUsers}" var="contact" label="#{contact}"/>
					<a:support id="send" action="#{recommendationAction.recommendItem(contentItem)}" event="onviewactivated" reRender="inplaceSelect" />
		</rich:inplaceSelect>
		</span>      
        <br />
		<kiwi:tagListEditor label="Tags: " 
			tagItems="#{kiwi.wiki.tagCloudAction.tagCloud}" />
		
		<div id="rating"></div>
		<br />

        <script>
	        jQuery(document).ready(function(){
		        jQuery('#rating').rating({
		            label:		   'Rating: ',
                    uri:           '#{currentContentItem.resource.uri}',
				    user:          '#{currentUser.login}',
				    webServiceUrl: '#{facesContext.externalContext.requestContextPath}/seam/resource/services/widgets/rating'
				});
	        });  
        </script>
        -->
			
	        <s:div rendered="#{contentItem.mediaContent != null}" >
	            <center>
					<kiwi:mediaContent contentItem="#{contentItem}" 
							edit="true"
							style="padding: 3px; margin:4px;border:solid 1px #ccc;">
						<ui:define name="nomedia">
							<h:outputText value="No image" />
						</ui:define>
						<s:transformImageSize 
							maintainRatio="true"
							width="400"/>
					</kiwi:mediaContent>
			    </center>
			</s:div>
	        
	        <!-- include resource from webservice so that we can support JSF tags inside the content -->
	        
	        <kiwi:renderHtml contentItem="#{contentItem}" user="#{currentUser}/>     
	        <kiwi:microformats contentItem="#{contentItem}"/>
	        
	        <ui:include src="../dialogs/ieActiveLearningFragmentsPanel.xhtml"/>
	     
</ui:composition>