<?xml version="1.0" encoding="UTF-8"?>
<pages xmlns="http://jboss.com/products/seam/pages"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.0.xsd"
	   login-view-id="/interedu/login.xhtml"
       no-conversation-view-id="/home.xhtml">

    <page view-id="/interedu/*">
        <action execute="#{currentApplicationFactory.switchApplication('interedu')}"/>
        <navigation>
 	       <rule if-outcome="login">
                <redirect view-id="/interedu/login.xhtml"/>
        	</rule>
        	<rule if-outcome="register">
            	<redirect view-id="/interedu/register.xhtml"/>
        	</rule>
        </navigation>
		<navigation from-action="#{identity.login}">
			<rule if="#{identity.loggedIn}">
                <end-conversation before-redirect="true"/>
				<redirect view-id="/interedu/home.xhtml"/>
			</rule>
		</navigation>
		
		<navigation from-action="#{identity.logout}">
			<rule if="#{!identity.loggedIn}">
                <end-conversation before-redirect="true"/>
				<redirect view-id="/interedu/home.xhtml"/>
			</rule>
		</navigation>
		
    </page>

	<page view-id="/interedu/home.xhtml" >
		<begin-conversation join="true"/>
   		<navigation>
     		<rule if-outcome="search">
        		<redirect view-id="/interedu/search.xhtml"/>
      		</rule>
    	</navigation>
	</page>
	
	<page view-id="/interedu/article.xhtml" >
   		<navigation>
     		<rule if-outcome="search">
        		<redirect view-id="/interedu/search.xhtml"/>
      		</rule>
    	</navigation>
	</page>
	
	<page view-id="/interedu/register.xhtml">
    	<navigation from-action="#{registerAction.register}">   	    
    		<rule if-outcome="success">
    			<redirect view-id="/interedu/login.xhtml"/> <!--  should rather try to restore the previous view -->
    		</rule>
    		<rule>
    			<redirect view-id="/interedu/register.xhtml"/>
    		</rule>
    	</navigation>
    </page>
    
   <exception>
        <redirect view-id="/interedu/error.xhtml">
            <message>Unexpected error, please try again</message>
        </redirect>
    </exception>

</pages>