<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:rich="http://richfaces.org/rich"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:kiwi="http://www.kiwi-project.eu/jsf"
    xmlns:c="http://java.sun.com/jstl/core"
	xmlns:a4j="http://richfaces.org/a4j">

    <div id="header">
        <!-- define a view-global queue for ajax requests -->
        <a4j:queue/>
	    <div id="logo">
		    <s:link view="/home.xhtml">
		        <f:param name="title" />
	            <f:param name="uri" value="#{configurationService.startPage}"/>
	            <f:param name="id" />
	            <f:param name="kiwiid"/>
	            <img src="#{facesContext.externalContext.requestContextPath}/w2k/ways2know_logo.jpg" alt="KiWi Logo" />
	        </s:link>	    
	   </div>
	    <div id="mainnav">
	        <h:form id="formHdrApplications">
		        <ul>
		        	<li>
	                    <s:link view="/w2k/tagcloud.xhtml">
	                        <span class="mainnav_title"><h:outputText value="TagCloud" /></span>
	                        <span class="mainnav_subtitle"><h:outputText value="Explore Tags"/></span>
	                    </s:link>		        		
		        	</li>
		        	<li>
	                    <s:link view="/w2k/exhibit.html">
	                        <span class="mainnav_title"><h:outputText value="Exhibit" /></span>
	                        <span class="mainnav_subtitle"><h:outputText value="Explore timeline"/></span>
	                    </s:link>		        		
		        	</li>
		        	<li>
	                    <s:link view="/w2k/visualizeThesaurus/RelationBrowser.xhtml">
	                        <span class="mainnav_title"><h:outputText value="Thesaurus" /></span>
	                        <span class="mainnav_subtitle"><h:outputText value="Explore Concepts"/></span>
	                    </s:link>		        		
		        	</li>
		            <ui:repeat value="#{kiwi.ui.headerAction.applications}" var="app">
		                <li>
		                    <h:commandLink action="#{kiwi.ui.headerAction.switchApplication(app)}" rendered="#{app.isVisible()}">
		                        <span class="mainnav_title"><h:outputText value="#{app.name}" /></span>
		                        <span class="mainnav_subtitle"><h:outputText value="#{messages[fn:join(fn:join('app.',app.identifier),'.description')]}"/></span>
		                    </h:commandLink>
		                </li>
		            </ui:repeat>
		        </ul>   
	        </h:form>
	    </div>
	    <div id="searchbox">
	       <a4j:form id="formHdrSearch">
	           <a4j:queue />
	           <!--BEGIN: interedu hack -->
	           <s:fragment rendered="#{currentApplication.identifier ne 'interedu'}">
		       <h:inputText id="hdrSearchBox" value="#{searchAction.searchQuery}"/>
		       <!-- 
               <rich:suggestionbox for="hdrSearchBox" suggestionAction="#{searchAction.autocomplete}" var="result" >
               <h:column>
                    <h:outputText value="#{result}" />
               </h:column>
               </rich:suggestionbox>	          
               -->
               <a4j:commandButton id="hdrSearchBtn" action="#{searchAction.getSearchView()}"  style="border: 0" image="/img/search.png" value="#{messages['hdr.search']}" type="submit">
	               <s:defaultAction/>
	           </a4j:commandButton>
	           
	           </s:fragment>
	           <!-- 
	           <s:fragment rendered="#{currentApplication.identifier eq 'interedu'}">
	           		       <h:inputText id="hdrIntereduSearchBox" value="#{interedu.searchAction.searchQuery}"/>
               <a4j:commandButton id="hdrIntereduSearchBtn" action="#{interedu.searchAction.getSearchView()}" style="border: 0" image="/img/search.png" value="#{messages['hdr.search']}" type="submit">
	               <s:defaultAction/>
	           </a4j:commandButton>
	           </s:fragment>
	           -->
	        
	       <br/>    
		           <!-- END: interedu hack -->
           </a4j:form>
           
			<h:commandButton value="Erweiterte Suche" id = 'intereduExtendedSearch' rendered="#{currentApplication.identifier eq 'interedu'}">
	           <rich:componentControl for="intereduExtendedSearchPanel"
							attachTo="intereduExtendedSearch" operation="show" event="onclick" />
	        </h:commandButton>
	       
	    </div>
    </div>

    <div id="navbar">
        <h:form id="formHdrNavigation">
            <a4j:queue/>
		    <div id="history">
		        <ui:insert name="actions"/>
		    
		        <h:outputText value="History: " />
		        <c:forEach items="#{kiwi.ui.historyAction.lastItems}" var="item" varStatus="status">
		            <h:outputText value=" - " rendered="#{not status.first}"/>
		            <kiwi:link contentItem="#{item}" value="#{kiwi.ui.historyAction.ellipseString(item.title)}"/>
		        </c:forEach>
		    </div>
		    <div id="user">
		    
		    
	            <h:outputText value="#{messages['hdr.welcome']}, #{currentUser.firstName} #{currentUser.lastName}!"
	                       rendered="#{identity.loggedIn}" />
            
                <s:fragment rendered="#{not identity.loggedIn}">
		            <s:link action="login" 
		                     value="#{messages['hdr.login']}" />
                </s:fragment>	
                                    
	            <h:outputText value=" - " />
	
	            <s:link action="register" 
	                     value="#{messages['hdr.signup']}"
	                  rendered="#{not identity.loggedIn}" />
	        
	            <s:link action="#{identity.logout}" 
	                     value="#{messages['hdr.logout']}"
	                  rendered="#{identity.loggedIn}" />	    
	
	
	            <div id="status">
                    <a4j:region>
                        <a4j:push interval="1000" eventProducer="#{kiwi.core.statusService.addListener}" reRender="statusIndicator,statusTooltip" id="push"/>
                    </a4j:region>
                    <a4j:outputPanel id="statusIndicator">
                        <h:graphicImage  
                            url="#{facesContext.externalContext.requestContextPath}/img/status-running.gif" 
                            title="#{kiwi.core.statusService.systemStatus.size()} tasks currently in progress (click for more information)..." 
                            rendered="#{not kiwi.core.statusService.systemStatus.isEmpty()}">
                        </h:graphicImage>
                        <h:graphicImage  
                            url="#{facesContext.externalContext.requestContextPath}/img/status-stopped.gif" 
                            title="currently no background tasks (click for more information)" 
                            rendered="#{kiwi.core.statusService.systemStatus.isEmpty()}">
                        </h:graphicImage>
                    </a4j:outputPanel>
                    <rich:toolTip for="statusIndicator"
                                  id="statusTooltip"
                                  mode="ajax"
                                  showEvent="onclick" 
                                  direction="bottom-left" 
                                  styleClass="tooltip" 
                                  layout="block">
			            <f:facet name="defaultContent">
			                <strong>Please wait...</strong>
			            </f:facet>
                        <s:div rendered="#{not kiwi.core.statusService.systemStatus.isEmpty()}">
	                        <ul>
	                            <ui:repeat var="status" value="#{kiwi.core.statusService.systemStatus}">
	                                <li><h:outputText value="#{status.name} is running " /> 
	                                    <s:span rendered="#{status.hasProgress()}">(<h:outputText value="#{status.progress}%"/>)</s:span>
	                                    <s:span> <br/>(<h:outputText value="#{status.message}"/>)</s:span>
	                                </li>
	                            </ui:repeat>                            
	                        </ul>
                        </s:div>
                        <s:div rendered="#{kiwi.core.statusService.systemStatus.isEmpty()}">
                            <p>there are currently no active background tasks ...</p>
                        </s:div>
                    </rich:toolTip>
	            </div>
		    </div>
	    </h:form>
    </div>
	
</ui:composition>